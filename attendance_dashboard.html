<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance - Brilliant Minds Tuition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            /* Student Dashboard Custom Dark Blue Theme */
            --sidebar-bg: #1B3C53; /* User's custom dark blue */
            --primary-blue: #1B3C53; /* Using the same color for accents */
            --light-blue-bg: #EBF2F8; /* A complementary light blue-gray */
            
            --text-dark: #212529;
            --text-light: #6C757D;
            --bg-color: #F8F9FA;
            --border-color: #DEE2E6;
            --white-color: #FFFFFF;
            --danger-color: #DC2626;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-dark);
        }

        .font-serif { font-family: 'Playfair Display', serif; }

        /* --- Main Layout --- */
        .dashboard-layout {
            display: grid;
            grid-template-columns: auto 1fr;
            height: 100vh;
            overflow: hidden;
        }

        .sidebar {
            background-color: var(--sidebar-bg);
            width: 16rem;
            transition: width 0.3s ease-in-out, transform 0.3s ease-in-out;
            z-index: 30;
            overflow-y: auto; /* Ensures sidebar is scrollable */
        }
        .sidebar.collapsed { width: 5rem; }
        
        /* --- Custom Scrollbar for Sidebar --- */
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }
        .sidebar::-webkit-scrollbar-track {
            background: transparent;
        }
        .sidebar::-webkit-scrollbar-thumb {
            background: #2c5d8a; /* A slightly lighter shade of the sidebar blue */
            border-radius: 10px;
        }
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #3e80c2;
        }

        .content-wrapper {
            height: 100vh;
            overflow-y: auto;
        }

        .attendance-main {
            padding: 2rem 2.5rem;
        }
        
        .card {
            background-color: var(--white-color);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.04), 0 2px 4px -2px rgb(0 0 0 / 0.04);
        }
        
        /* --- Heatmap Styling --- */
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.1rem; /* Even smaller gap */
        }
        .heatmap-day {
            aspect-ratio: 1 / 1;
            border-radius: 0.125rem; /* 2px */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem; /* Smaller font size */
            color: var(--text-dark);
        }
        .day-present { background-color: #4CAF50; color: white; }
        .day-absent { background-color: #F44336; color: white; }
        .day-holiday { background-color: #FFC107; }
        .day-future { background-color: #F0F0F0; border: 1px solid #E0E0E0; }
        .day-empty { background-color: transparent; }

        .sidebar.collapsed .icon-text { opacity: 0; width: 0; }
        .sidebar.collapsed .sidebar-toggle i { transform: rotate(180deg); }

        @media (max-width: 1024px) {
            .sidebar {
                position: absolute;
                left: 0;
                top: 0;
                height: 100%;
                transform: translateX(-100%);
            }
            .sidebar.open { transform: translateX(0); }
            #mobileMenuButton { display: block; }
        }
    </style>
</head>
<body>

    <div class="dashboard-layout">
        
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar flex flex-col p-4 text-gray-200">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3 overflow-hidden">
                    <i class="fa-solid fa-graduation-cap text-3xl text-white"></i>
                    <span class="font-serif text-2xl font-bold whitespace-nowrap icon-text">Brilliant Minds</span>
                </div>
                <button id="sidebarToggle" class="sidebar-toggle hidden lg:block cursor-pointer p-2 rounded-full hover:bg-white/10">
                    <i class="fas fa-chevron-left transition-transform duration-300"></i>
                </button>
            </div>
            <nav class="mt-10 space-y-2 flex-grow">
                <a href="student_dashboard.html" class="flex items-center py-3 px-4 rounded-lg hover:bg-white/10">
                    <i class="fas fa-tachometer-alt w-6 text-center text-lg"></i><span class="icon-text ml-4">Dashboard</span>
                </a>
                <a href="attendance_dashboard.html" class="flex items-center py-3 px-4 rounded-lg bg-white/10 text-white">
                    <i class="fas fa-clipboard-user w-6 text-center text-lg"></i><span class="icon-text ml-4 font-semibold">Attendance</span>
                </a>
                <a href="assignments_page.html" class="flex items-center py-3 px-4 rounded-lg hover:bg-white/10">
                    <i class="fas fa-clipboard-list w-6 text-center text-lg"></i><span class="icon-text ml-4">Assignments</span>
                </a>
                <a href="e_library.html" class="flex items-center py-3 px-4 rounded-lg hover:bg-white/10">
                    <i class="fas fa-book-bookmark w-6 text-center text-lg"></i><span class="icon-text ml-4">Library</span>
                </a>
                <a href="fee_payment.html" class="flex items-center py-3 px-4 rounded-lg hover:bg-white/10">
                    <i class="fas fa-money-check-dollar w-6 text-center text-lg"></i><span class="icon-text ml-4">Fee Payment</span>
                </a>
                <a href="test_section.html" class="flex items-center py-3 px-4 rounded-lg hover:bg-white/10">
                    <i class="fas fa-file-alt w-6 text-center text-lg"></i><span class="icon-text ml-4">Test Portal</span>
                </a>
                <a href="student_profile.html" class="flex items-center py-3 px-4 rounded-lg hover:bg-white/10">
                    <i class="fas fa-user-circle w-6 text-center text-lg"></i><span class="icon-text ml-4">Profile</span>
                </a>
            </nav>
            <div class="mt-auto">
                <a href="#" class="flex items-center py-3 px-4 rounded-lg hover:bg-white/10">
                    <i class="fas fa-sign-out-alt w-6 text-center text-lg"></i><span class="icon-text ml-4">Logout</span>
                </a>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="content-wrapper">
            <main class="attendance-main">
                <!-- Header -->
                <header class="mb-8">
                    <h1 class="font-serif text-4xl font-bold text-text-dark">Attendance Record</h1>
                    <p class="text-md text-text-light mt-1">Review your attendance summary and monthly trends.</p>
                </header>

                <!-- Attendance Summary -->
                <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="card p-5">
                        <p class="text-sm text-text-light font-medium">Overall Percentage</p>
                        <p class="text-3xl font-bold text-green-600 mt-1">95%</p>
                    </div>
                    <div class="card p-5">
                        <p class="text-sm text-text-light font-medium">Total Days Present</p>
                        <p class="text-3xl font-bold mt-1">152</p>
                    </div>
                    <div class="card p-5">
                        <p class="text-sm text-text-light font-medium">Total Days Absent</p>
                        <p class="text-3xl font-bold text-danger-color mt-1">8</p>
                    </div>
                </section>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Monthly Attendance Bar Graph -->
                    <div class="lg:col-span-2 card p-6">
                        <h2 class="font-serif text-xl font-bold text-text-dark mb-4">Monthly Trends</h2>
                        <div class="h-80">
                            <canvas id="monthlyAttendanceChart"></canvas>
                        </div>
                    </div>
                    <!-- Heatmap Calendar -->
                    <div class="lg:col-span-1 card p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 id="calendar-title" class="font-serif text-xl font-bold text-text-dark"></h2>
                            <div class="flex gap-1">
                                <button id="prev-month" class="p-2 w-8 h-8 rounded-full hover:bg-gray-100"><i class="fa-solid fa-chevron-left text-xs"></i></button>
                                <button id="next-month" class="p-2 w-8 h-8 rounded-full hover:bg-gray-100"><i class="fa-solid fa-chevron-right text-xs"></i></button>
                            </div>
                        </div>
                        <div class="grid grid-cols-7 gap-1 mb-2">
                            <div class="font-semibold text-center text-text-light text-xs">S</div>
                            <div class="font-semibold text-center text-text-light text-xs">M</div>
                            <div class="font-semibold text-center text-text-light text-xs">T</div>
                            <div class="font-semibold text-center text-text-light text-xs">W</div>
                            <div class="font-semibold text-center text-text-light text-xs">T</div>
                            <div class="font-semibold text-center text-text-light text-xs">F</div>
                            <div class="font-semibold text-center text-text-light text-xs">S</div>
                        </div>
                        <div id="heatmap-grid" class="heatmap-grid">
                            <!-- Calendar days will be generated by JS -->
                        </div>
                        <div class="flex flex-wrap justify-end gap-x-4 gap-y-1 mt-4 text-xs">
                            <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full day-present"></div> Present</div>
                            <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full day-absent"></div> Absent</div>
                            <div class="flex items-center gap-2"><div class="w-3 h-3 rounded-full day-holiday"></div> Holiday</div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
            });

            // --- Calendar Heatmap Logic ---
            const calendarTitle = document.getElementById('calendar-title');
            const heatmapGrid = document.getElementById('heatmap-grid');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');

            let currentDate = new Date();

            // Mock attendance data
            const attendanceData = {
                '2025-8-15': 'absent',
                '2025-8-6': 'holiday',
                '2025-7-20': 'absent'
            };

            function renderCalendar(date) {
                const year = date.getFullYear();
                const month = date.getMonth();

                calendarTitle.textContent = date.toLocaleString('default', { month: 'short', year: 'numeric' });
                heatmapGrid.innerHTML = '';

                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                // Add empty cells for days before the 1st
                for (let i = 0; i < firstDayOfMonth; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'heatmap-day day-empty';
                    heatmapGrid.appendChild(emptyCell);
                }

                // Add days of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayCell = document.createElement('div');
                    dayCell.className = 'heatmap-day';
                    dayCell.textContent = day; // Added number back

                    const dateString = `${year}-${month + 1}-${day}`;
                    const today = new Date();
                    const cellDate = new Date(year, month, day);

                    if (cellDate > today) {
                        dayCell.classList.add('day-future');
                    } else if (attendanceData[dateString]) {
                        dayCell.classList.add(`day-${attendanceData[dateString]}`);
                    } else {
                        dayCell.classList.add('day-present');
                    }
                    
                    heatmapGrid.appendChild(dayCell);
                }
            }

            prevMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar(currentDate);
            });

            nextMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar(currentDate);
            });

            renderCalendar(currentDate);


            // --- Monthly Attendance Chart Logic ---
            const monthlyData = {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug'],
                percentages: [98, 96, 100, 95, 98, 92, 97, 94],
                totalDays: [22, 20, 23, 21, 22, 20, 22, 21]
            };
            
            const presentDays = monthlyData.percentages.map((p, i) => Math.round((p / 100) * monthlyData.totalDays[i]));
            
            const ctx = document.getElementById('monthlyAttendanceChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: monthlyData.labels,
                    datasets: [{
                        label: 'Attendance',
                        data: monthlyData.percentages,
                        backgroundColor: 'rgba(27, 60, 83, 0.8)',
                        borderColor: 'rgba(27, 60, 83, 1)',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%'
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const monthIndex = context.dataIndex;
                                    const present = presentDays[monthIndex];
                                    const total = monthlyData.totalDays[monthIndex];
                                    return `${present} / ${total} days`;
                                },
                                afterLabel: function(context) {
                                    return `(${context.raw}%)`;
                                }
                            }
                        }
                    }
                }
            });
        });     
    </script>
</body>
</html>
